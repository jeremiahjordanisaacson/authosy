# Authosy

**Uplifting news, verified and rewritten with care.**

Authosy is an automated system that discovers positive news from reputable sources, verifies each story through multiple independent reports, and publishes them to a static website. Every story is rewritten in an optimistic, grounded voice with full source attribution.

## Architecture

```
authosy/
├── site/                    # Astro static site
│   ├── src/
│   │   ├── content/stories/ # Markdown story files (generated by service)
│   │   ├── pages/           # Site pages
│   │   ├── layouts/         # Page layouts
│   │   ├── components/      # UI components
│   │   └── styles/          # CSS
│   └── astro.config.mjs
├── service/                 # .NET Worker Service
│   └── Authosy.Service/
│       ├── Models/          # Data models and config
│       ├── Services/        # Core services (RSS, clustering, Claude, git)
│       ├── Worker.cs        # Main pipeline orchestrator
│       └── appsettings.json # Configuration with feed list
├── .github/workflows/       # GitHub Actions for Pages deployment
└── docs/                    # PowerShell scripts and documentation
```

## How It Works

1. **Discovery** — The service monitors 14+ RSS feeds from outlets like AP, Reuters, BBC, NPR, Seattle Times, and dedicated positive news sources.
2. **Classification** — Each item is classified by Claude for positivity (0–1 scale). Only items scoring ≥ 0.6 proceed.
3. **Verification** — Items are clustered using TF-IDF cosine similarity. A story must appear in ≥ 2 distinct reputable sources.
4. **Rewriting** — Claude rewrites each verified story in Authosy's voice: optimistic, factual, non-sensational, 500–900 words.
5. **Publishing** — Stories are saved as markdown, committed, and pushed. GitHub Actions rebuilds the site automatically.

## Running the Site Locally

```bash
cd site
npm install
npm run dev
```

The site runs at `http://localhost:4321`. It builds successfully even with zero stories.

To build for production:

```bash
cd site
npm run build
npm run preview
```

## Configuring the Service

### Prerequisites

- .NET 9.0 SDK
- Claude Code CLI (`claude`) in PATH
- Git in PATH
- A GitHub personal access token with repo push permission

### Environment Variables

| Variable | Purpose | Where to store |
|---|---|---|
| `GITHUB_TOKEN` | Git push authentication | System environment variable or Windows Credential Manager |
| `Authosy__RepoPath` | Override repo path at runtime | User/system environment variable |

**Setting the token (PowerShell as Admin):**
```powershell
[System.Environment]::SetEnvironmentVariable('GITHUB_TOKEN', 'ghp_your_token', 'Machine')
```

### Configuration

Edit `service/Authosy.Service/appsettings.json`:

- `Authosy:RepoPath` — Absolute path to your local clone of this repo
- `Authosy:Feeds` — RSS feed list (add, remove, or modify)
- `Authosy:IntervalMinutes` — How often the pipeline runs (default: 60)
- `Authosy:MaxItemsPerRun` — Maximum stories per cycle (default: 10)
- `Authosy:ClaudeCliPath` — Path to Claude CLI (default: `claude`)

## Running the Service

### Console Mode (Single Run)

For debugging and testing:

```powershell
.\docs\RunOnce.ps1
```

Or manually:

```bash
cd service/Authosy.Service
dotnet run -- --RunOnce true
```

### Installing as a Windows Service

**Install (requires Administrator):**

```powershell
.\docs\InstallService.ps1
```

This publishes the project, creates the Windows service with auto-restart on failure, and sets delayed auto-start.

**Start the service:**

```powershell
Start-Service "Authosy News Service"
```

**Uninstall:**

```powershell
.\docs\UninstallService.ps1
```

### Logs

- **Console output** — visible in RunOnce mode
- **File logs** — `service/Authosy.Service/logs/authosy-YYYYMMDD.log` (rolling, 30 days)
- **Windows Event Log** — under source "Authosy" (when running as a service)

## Content Model

Stories are stored as markdown with YAML frontmatter in `site/src/content/stories/`:

```yaml
---
id: "a1b2c3d4e5f6"
title: "Community Garden Opens in Capitol Hill"
region: "seattle"
date_published: "2025-01-15T14:30:00Z"
summary: "A new community garden brings neighbors together..."
tags:
  - "community"
  - "environment"
  - "seattle"
source_urls:
  - "https://example.com/article1"
  - "https://example.com/article2"
positivity_score: 0.85
confidence_score: 0.92
---

Article body in markdown...
```

## Site Features

- **Search** — Client-side full-text search using a generated JSON index
- **Region filtering** — Filter by Seattle, USA, or World
- **RSS feed** — Available at `/authosy/rss.xml`
- **Accessible** — Semantic HTML, skip links, keyboard navigation, WCAG-friendly contrast
- **Mobile-first** — Responsive grid layout
- **No tracking** — Zero analytics, cookies, or external scripts

## Git Authentication

The service uses `GITHUB_TOKEN` environment variable for push authentication. Configure your git remote URL to include the token:

```bash
git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/jeremiahjordanisaacson/authosy.git
```

Or set `Authosy:GitRemoteUrl` in the config to use a specific remote URL.
